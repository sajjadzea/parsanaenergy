name: Build & Deploy

on:
  push:
    branches: [main]
    paths: ["docs/**","decision-tree-app/**"]

jobs:
    deploy:
      runs-on: ubuntu-latest
      permissions:
        contents: write
        pages: write
      steps:
        - uses: actions/checkout@v4
        - uses: actions/setup-node@v4
          with: {node-version: 18, cache: 'npm'}

        - name: Build widget
          working-directory: decision-tree-app
          run: |
            npm ci --legacy-peer-deps
            npm run build-widget

        - name: Build landing
          working-directory: docs
          run: |
            npm ci --legacy-peer-deps
            npm run build

        - name: Deploy
          uses: peaceiris/actions-gh-pages@v4
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            publish_dir: docs/dist
            cname: parsanaenergy.ir

